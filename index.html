<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Tucson's Best Cycling Routes</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:fixed; top:0; bottom:0; right:0; width:80%; z-index: 1}

        #features {
        position: absolute;
        top:0; left:0;
        width: 20%;
        font-family: sans-serif;
        /*overflow-y: scroll;*/
        background-color: #fafafa;
        }

        section {
        padding:  25px 50px;
        line-height: 25px;
        border-bottom: 1px solid #ddd;
        opacity: 0.25;
        font-size: 13px;
        }
        section.active {
        opacity: 1;
        }
        section:last-child {
        border-bottom: none;
        margin-bottom: 200px;
        }
        
        #instructions {
            height:50px;
            min-height:80px;
            width: 200px;
            position: absolute;
            top: 430px;
            left: 25px;
            background-color: rgba(255, 255, 255, .4);
            border: solid 3px #A0A0A0;
            padding: 15px;
            text-align: left;
            font-family: 'Arial';
            margin: 0;
            font: 15px;
            overflow-y: scroll; /*scroll after max height is reached*/
            font-weight: bold;
            z-index: 2;
            }

        #geojsonbox {
            height:30px;
            min-height:80px;
            width: 200px;
            position: absolute;
            top: 570px;
            left: 25px;
            background-color: rgba(255, 255, 255, .4);
            border: solid 3px #A0A0A0;
            padding: 15px;
            text-align: left;
            font-family: 'Arial';
            margin: 0;
            font-size: 13px;
            overflow-y: scroll; /*scroll after max height is reached*/
            word-wrap:break-word;
            z-index: 2;
            }

        #menu {
            /*background: #fff;*/
            position: absolute;
            z-index: 1;
            top: 60px;
            left: 10px;
            border-radius: 3px;
            width: 150px;
            padding:15px;
            /*border: 1px solid rgba(0,0,0,0.4);*/
            font-family: 'Open Sans', sans-serif;
            }
             
        #menu a {
            font-size: 13px;
            color: #404040;
            display: block;
            margin: 0;
            padding: 0;
            padding: 10px;
            text-decoration: none;
            border-bottom: 1px solid rgba(0,0,0,0.25);
            text-align: center;
            }
             
        #menu a:last-child {
            border: none;
            }
             
        #menu a:hover {
            background-color: #f8f8f8;
            color: #404040;
            }
             
        #menu a.active {
            background-color: #3887be;
            color: #ffffff;
            }
             
        #menu a.active:hover {
            background: #3074a4;
            }

        #calculated-line p {
            margin:0px;
        }

        #remover {
            margin: 0 auto;
            width: 130px;
            background-color: #fb5b3f;
            color: #fff;
            font-weight: bold;
            padding: 0.5em;
            border: 2px solid #fff;
            border-radius: 0.5em;
            box-shadow: 0px 0px 5px rgba(0,0,0,0.2);
            cursor: pointer;
            position: absolute;
            left: 25px; /*left: 10em;*/
            top: 20px;
            z-index: 2;
        }
        #remover:hover {
            background-color: salmon;
        }

        #info {
            display: block;
            position: relative;
            margin: 0px auto;
            width: 50%;
            padding: 10px;
            border: none;
            border-radius: 3px;
            font-size: 12px;
            text-align: center;
            color: #222;
            background: #fff;
            }

    </style>
</head>
<body>

<!--Mapbox APIs-->
<!--Mapbox Search Box-->
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.3.0/mapbox-gl-geocoder.min.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.3.0/mapbox-gl-geocoder.css' type='text/css' />
<!--Mapbox Directions-->
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.0.0/mapbox-gl-directions.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.0.0/mapbox-gl-directions.css' type='text/css' />
<!--Mapbox Draw-->
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.9/mapbox-gl-draw.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.9/mapbox-gl-draw.css' type='text/css'/>


<!--Initialize Map, Menu, & Info Box-->
<div id='map'>
    <div id='remover'>Add Satallite</div>
    <nav id="menu"></nav> 
    <div id='instructions'>
        <div id="calculated-line"></div>
    </div>
    <div id='geojsonbox'>
        <div><pre id='completegeojson'></pre></div>
        <!--<div id='coordsonlyID'>Coords Only Here:</div>-->
    </div>
    <pre id='info'></pre>
</div>

<div id="features">
    <section class="active" id="baker">
        <h3>
            221b Baker St.
        </h3>
        <p>
            November 1895. London is shrouded in fog and Sherlock Holmes and Watson pass time restlessly awaiting a new case. "The London criminal is certainly a dull fellow," Sherlock bemoans. "There have been numerous petty thefts," Watson offers in response. Just then a telegram arrives from Sherlock's brother Mycroft with a mysterious case.
        </p>
    </section>
    <section id="aldgate">
        <h3>
            Aldgate Station
        </h3>
        <p>
            Arthur Cadogan West was found dead, head crushed in on train tracks at Aldgate Station at 6AM Tuesday morning. West worked at Woolwich Arsenal on the Bruce-Partington submarine, a secret military project. Plans for the submarine had been stolen and seven of the ten missing papers were found in West's possession. Mycroft implores Sherlock to take the case and recover the three missing papers.
        </p>
    </section>
    <section id="london-bridge">
        <h3>
            London Bridge
        </h3>
        <p>
            Holmes and Watson's investigations take them across London. Sherlock deduces that West was murdered elsewhere, then moved to Aldgate Station to create the illusion that he was crushed on the tracks by a train. On their way to Woolwich Sherlock dispatches a telegram to Mycroft at London Bridge: "Send list of all foreign spies known to be in England, with full address."
        </p>
    </section>
    <section id="woolwich">
        <h3>
            Woolwich Arsenal
        </h3>
        <p>
            While investigating at Woolwich Arsenal Sherlock learns that West did not have the three keys—door, office, and safe—necessary to steal the papers. The train station clerk mentions seeing an agitated West boarding the 8:15 train to London Bridge. Sherlock suspects West of following someone who had access to the Woolwich chief's keyring with all three keys.
        </p>
    </section>
    <section id="gloucester">
        <h3>
            Gloucester Road
        </h3>
        <p>
            Mycroft responds to Sherlock's telegram and mentions several spies. Hugo Oberstein of 13 Caulfield Gardens catches Sherlock's eye. He heads to the nearby Gloucester Road station to investigate and learns that the windows of Caulfield Gardens open over rail tracks where trains stop frequently.
        </p>
    </section>
    <section id="caulfield-gardens">
        <h3>
            13 Caulfield Gardens
        </h3>
        <p>
            Holmes deduces that the murderer placed West atop a stopped train at Caulfield Gardens. The train traveled to Aldgate Station before West's body finally toppled off. Backtracking to the criminal's apartment, Holmes finds a series of classified ads from
            <em>
                The Daily Telegraph
            </em>
            stashed away. All are under the name Pierrot: "Monday night after nine. Two taps. Only ourselves. Do not be so suspicious. Payment in hard cash when goods delivered."
        </p>
    </section>
    <section id="telegraph">
        <h3>
            The Daily Telegraph
        </h3>
        <p>
            Holmes and Watson head to The Daily Telegraph and place an ad to draw out the criminal. It reads: "To-night. Same hour. Same place. Two taps. Most vitally important. Your own safety at stake. Pierrot." The trap works and Holmes catches the criminal: Colonel Valentine Walter, the brother of Woolwich Arsenal's chief. He confesses to working for Hugo Oberstein to obtain the submarine plans in order to pay off his debts.
        </p>
    </section>
    <section id="charing-cross">
        <h3>
            Charing Cross Hotel
        </h3>
        <p>
            Walter writes to Oberstein and convinces him to meet in the smoking room of the Charing Cross Hotel where he promises additional plans for the submarine in exchange for money. The plan works and Holmes and Watson catch both criminals.
        </p>
        <small id="citation">
            Adapted from
            <a href="http://www.gutenberg.org/files/2346/2346-h/2346-h.htm">
                Project Gutenberg
            </a>
        </small>
    </section>
</div>

<script>

//---------------------------------------------------------------------------------------
// ------------------------------- Step 1: Create The Map -------------------------------
//---------------------------------------------------------------------------------------
// All parameter options such as attributionControl, minZoom, style, etc... are found here... https://docs.mapbox.com/mapbox-gl-js/api/#map

mapboxgl.accessToken = 'pk.eyJ1IjoiZHlsYW5jIiwiYSI6Im53UGgtaVEifQ.RJiPqXwEtCLTLl-Vmd1GWQ';
var map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'mapbox://styles/dylanc/cjtc75i652sp41fqrckja69dq',
    //style: 'mapbox://styles/dylanc/cjsfuwcf00fby1fpnt4n5iokq', // stylesheet location
    center: [-110.926757, 32.215554 ], // starting position [lng, lat]
    zoom: 11.5, // starting zoom
    attributionControl: false, // Removed default attribution and put custom attribution in below
    maxBounds: [[-111.2,32], [-110.6, 32.5]], //Southwest & Northeast Bounds
    pitch: 45,
    bearing: 10,
});

map.on('mousemove', function (e) {
document.getElementById('info').innerHTML =
// e.point is the x, y coordinates of the mousemove event relative
// to the top-left corner of the map
JSON.stringify(e.point) + '<br />' +
// e.lngLat is the longitude, latitude geographical position of the event
JSON.stringify(e.lngLat);
});

var chapters = {
'baker': {
    bearing: 10,
    center: [-110.926757, 32.215554],
    zoom: 11.5,
    pitch: 45
},
'aldgate': {
    duration: 6000,
    center: [-110.907800,32.22162],
    bearing: -10,
    zoom: 14.5,
    pitch: 0
},
'london-bridge': {
    bearing: 20,
    center: [-110.929702,32.21926065],
    zoom: 12,
    speed: 0.6,
    pitch: 40
},
'woolwich': {
bearing: -10,
center: [-110.8880799,32.2150097],
zoom: 13.5,
speed: 0.3
},
'gloucester': {
    bearing: 15,
    center: [-110.9545, 32.2524],
    zoom: 15.3,
    pitch: 20,
    speed: 0.5
},
'caulfield-gardens': {
    bearing: -15,
    center: [-110.89, 32.21],
    zoom: 12.3
},
'telegraph': {
    bearing: 10,
    center: [-110.9747, 32.2226],
    zoom: 17.3,
    pitch: 40
},
'charing-cross': {
    bearing: 0,
    center: [-110.974, 32.2226],
    zoom: 14.3,
    pitch: 20
}
};
 
// On every scroll event, check which element is on screen
window.onscroll = function() {
var chapterNames = Object.keys(chapters);
for (var i = 0; i < chapterNames.length; i++) {
var chapterName = chapterNames[i];
if (isElementOnScreen(chapterName)) {
setActiveChapter(chapterName);
break;
}
}
};
 
var activeChapterName = 'baker';
function setActiveChapter(chapterName) {
if (chapterName === activeChapterName) return;
 
map.flyTo(chapters[chapterName]);
 
document.getElementById(chapterName).setAttribute('class', 'active');
document.getElementById(activeChapterName).setAttribute('class', '');
 
activeChapterName = chapterName;
}
 
function isElementOnScreen(id) {
var element = document.getElementById(id);
var bounds = element.getBoundingClientRect();
return bounds.top < window.innerHeight && bounds.bottom > 0;
}

//---------------------------------------------------------------------------------------
// --------------------------- Step 2: Add Data Layers  -----------------------------
//---------------------------------------------------------------------------------------

//Toggle Annotation
toggleLayer(
    ['country-label',
    'state-label', 
    'settlement-label', 
    'settlement-subdivision-label', 
    'airport-label', 
    'transit-label', 
    'poi-label', 
    'water-point-label', 
    'water-line-label', 
    'natural-point-label', 
    'natural-line-label', 
    'waterway-label', 
    'golf-hole-label', 
    'road-exit-shield', 
    'road-number-shield', 
    'road-label', 
    'building-number-label', 
    'contour-label'], 
    'Annotation'); //Button Name

//Toggle Standard Road Network
toggleLayer(
    ['road-oneway-arrow-white',
    'level-crossing', 
    'road-rail-tracks', 
    'road-rail', 
    'road-motorway-trunk', 
    'road-oneway-arrow-blue', 
    'road-primary', 
    'road-secondary-tertiary',
    'road-street', 
    'road-minor', 
    'road-polygon',
    'road-pedestrian-polygon-pattern', 
    'road-pedestrian-polygon-fill', 
    'road-pedestrian', 
    'road-major-link', 
    'road-steps', 
    'road-path-cycleway-piste', 
    'road-path-rough', 
    'road-path-smooth',
    'road-construction',
    'road-motorway-trunk-case',
    'road-major-link-case',
    'road-primary-case',
    'road-secondary-tertiary-case',
    'road-street-case',
    'road-minor-case',
    'road-street-low',
    'road-pedestrian-case',
    'road-steps-bg',
    'road-path-bg',
    'bridge-oneway-arrow-white',
    'bridge-motorway-trunk-2',
    'bridge-major-link-2',
    'bridge-motorway-trunk-2-case',
    'bridge-major-link-2-case',
    'bridge-rail-tracks',
    'bridge-rail',
    'bridge-motorway-trunk',
    'bridge-oneway-arrow-blue',
    'bridge-primary-secondary-tertiary',
    'bridge-street-minor',
    'bridge-pedestrian',
    'bridge-major-link',
    'bridge-steps',
    'bridge-path-cycleway-piste',
    'bridge-path-smooth-rough',
    'bridge-construction',
    'bridge-motorway-trunk-case',
    'bridge-major-link-case',
    'bridge-primary-secondary-tertiary-case',
    'bridge-street-minor-case',,
    'bridge-street-minor-low',
    'bridge-pedestrian-case',
    'bridge-steps-bg',
    'bridge-path-bg'], 
    'Standard Road Network'); //Button Name

//Toggle High Stress Road Network
toggleLayer(
    ['hs-do1x45'],
    'High Stress Road Network');

//Toggle All LS Original Road Network
toggleLayer(
    ['ls-790ous'], 'Low Stress Road Network');

toggleLayer(
    ['hawks-1sb3f4',
    'hawkroads-acywed'], 
    'Neighborhood Connections');

toggleLayer(
    ['tnr-v5-5pfsxq',
    //'tnr-v4-apmebo',
    //'tnr-v3-9wi26p',
    //'tnr-v2-06s5zd',
    //'tnr-v1-c7wnkt'
    ],
    'Recommended Bicycle Network'); //Button Name

toggleLayer(
    ['osm-bicycleinfras-5z6khj', 
    //'hs-do1x45 copy'
    ],
    'Recommended Bicycle Lanes'); //Button Name

function toggleLayer(ids, name) {
    var link = document.createElement('a');
    link.href = '#';
    link.className = 'active';
    link.textContent = name;

    link.onclick = function (e) {
        e.preventDefault();
        e.stopPropagation();
        for (layers in ids){
            var visibility = map.getLayoutProperty(ids[layers], 'visibility');
            if (visibility === 'visible') {
                map.setLayoutProperty(ids[layers], 'visibility', 'none');
                this.className = '';
            } else {
                this.className = 'active';
                map.setLayoutProperty(ids[layers], 'visibility', 'visible');
            }
         }
    };
    var layers = document.getElementById('menu');
    layers.appendChild(link);
}

//Add Separate Button For Toggling Individual Layers
map.on('load', function(){
    var switchy = document.getElementById('remover');
    switchy.addEventListener("click", function(){
        switchy = document.getElementById('remover');
        if (switchy.className === 'on') {
            switchy.setAttribute('class', 'off');
            map.setLayoutProperty('mapbox-satellite', 'visibility', 'none');
            switchy.innerHTML = 'Add Satellite';
        } else {
            switchy.setAttribute('class', 'on');
            map.setLayoutProperty('mapbox-satellite', 'visibility', 'visible');
            switchy.innerHTML = 'Remove Satallite';
        }
    });
});

//---------------------------------------------------------------------------------------
// -------------    Step 3: Add Data Layers Toggle Button   -----------------------------
//---------------------------------------------------------------------------------------

/* Might Not Need this section any more?


Generate Menu of Button for Toggling Layers
var toggleableLayerIds = [ 'Signaled Crosswalks', 'Bicycle Infrastructure',  'Future Buttons Here' ]; //Add toggleable layer ids here
 
for (var i = 0; i < toggleableLayerIds.length; i++) {
var id = toggleableLayerIds[i];
 
var link = document.createElement('a');
link.href = '#';
link.className = 'active';
link.textContent = id;

    link.onclick = function (e) {
        var clickedLayer = this.textContent;
        e.preventDefault();
        e.stopPropagation();
     
        var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
     
        if (visibility === 'visible') {
            map.setLayoutProperty(clickedLayer, 'visibility', 'none');
            this.className = '';
        } else {
            this.className = 'active';
            map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
        }
    };
     
    var layers = document.getElementById('menu');
    layers.appendChild(link);
    }
*/
//---------------------------------------------------------------------------------------
// --------------------------- Step 4: Create Custom Controls -----------------------------
//---------------------------------------------------------------------------------------

var draw = new MapboxDraw({
  displayControlsDefault: false,
  controls: {
    line_string: true,
    trash: true,
  },
  styles: [
    // For more info - Mapbox GL Style Spec - https://docs.mapbox.com/mapbox-gl-js/style-spec
    // ACTIVE (being drawn)
    // line stroke
    {
      "id": "gl-draw-line", // Required String - Unique layer name
      "type": "line", //Required types: fill, line, symbol, circle, heatmap, fill-extrusion, raster, hillshade, background)
      "filter": ["all", ["==", "$type", "LineString"], ["!=", "mode", "static"]], 
      "layout": { 
        "line-cap": "round", //e.g. butt (default), round, square
        "line-join": "round" //miter (default), bevel, round
      },
      "paint": { 
        "line-color": "#81A4CD", 
        "line-dasharray": [2, 4],
        "line-width": 2,
        "line-opacity": 0.7
        //line-translate
        //line-gap-width
        //line-gradient
        //etc...
      }
    },
    // vertex point halos - must come before vertex, because these are two layers of circles
    {
      "id": "gl-draw-polygon-and-line-vertex-halo-active",
      "type": "circle",
      "filter": ["all", ["==", "meta", "vertex"], ["==", "$type", "Point"], ["!=", "mode", "static"]],
      "paint": {
        "circle-radius": 8,
        "circle-color": "#FFF" 
      }
    },
    // vertex points
    {
      "id": "gl-draw-polygon-and-line-vertex-active",
      "type": "circle",
      "filter": ["all", ["==", "meta", "vertex"], ["==", "$type", "Point"], ["!=", "mode", "static"]],
      "paint": {
        "circle-radius": 5,
        "circle-color": "#3E7CB1", 
      }
    },
    // midpoint point halos
    {
      "id": "gl-draw-polygon-and-line-midpoint-halo-active",
      "type": "circle",
      "filter": ["all", ["==", "meta", "midpoint"], ["==", "$type", "Point"], ["!=", "mode", "static"]],
      "paint": {
        "circle-radius": 4,
        "circle-color": "#FFF" 
      }
    },
    // midpoint points
    {
        "id": "gl-draw-polygon-and-line-midpoint-active",
        "type": "circle",
        "filter": ["all", ["==", "meta", "midpoint"], ["==", "$type", "Point"], ["!=", "mode", "static"]],
        "paint": {
            "circle-radius": 3,
            "circle-color": "#3E7CB1",
        }
    },
  ]
});

// add create, update, or delete actions
map.on('draw.create', updateRoute);
map.on('draw.update', updateRoute);
map.on('draw.delete', removeRoute);

// use the coordinates you just drew to make your directions request
function updateRoute() {
  removeRoute(); // overwrite any existing layers
  var data = draw.getAll();
  var answer = document.getElementById('calculated-line');
  var lastFeature = data.features.length - 1;
  var coords = data.features[lastFeature].geometry.coordinates;
  var newCoords = coords.join(';')
  getMatch(newCoords);
}

// make a directions request
function getMatch(e) {
  var url = 'https://api.mapbox.com/directions/v5/mapbox/cycling/' + e +'?geometries=geojson&steps=true&&access_token=' + 'pk.eyJ1IjoiZHlsYW5jIiwiYSI6Im53UGgtaVEifQ.RJiPqXwEtCLTLl-Vmd1GWQ';
  var req = new XMLHttpRequest();
  req.responseType = 'json';
  req.open('GET', url, true);
  req.onload  = function() {
    var jsonResponse = req.response;
    var distance = jsonResponse.routes[0].distance*0.001*0.621371;
    var duration = jsonResponse.routes[0].duration/60;
    var steps = jsonResponse.routes[0].legs[0].steps;
    var coords = jsonResponse.routes[0].geometry;
   
    //Get Distance and Duration
    instructions.insertAdjacentHTML('beforeend', '<p>' +  'Distance: ' + distance.toFixed(2) + ' mi<br>Duration: ' + duration.toFixed(2) + ' minutes' + '</p>');

    //Get Route Direction On Load Map
    steps.forEach(function(step){
        instructions.insertAdjacentHTML('beforeend', '<p>' + step.maneuver.instruction + '</p>')
    });

    //Get Route Geojson Coordinates

    /*/Basic proof of concept
    var output = "Geojson Coordinates: <br>" + coords.coordinates[0] + '<br>' + coords.coordinates[1] + '<br>' + coords.coordinates[2];
    document.getElementById("htmlcoords").innerHTML = output; //Essentially Links your JS Variable to the HTML ID you want associated with it */


    //Convert the jsonResponse from a Json into a formatted string ready to be sent to a server
    /*Returning the entire GeoJson
    var textedJson = JSON.stringify(jsonResponse, undefined, 2);
    document.getElementById("completegeojson").innerHTML = textedJson;*/

    /*Returning just the coordinates
    var x='';
    for (i = 0; i < jsonResponse.routes[0].geometry.coordinates.length; i++) {
        x = x + "[" + jsonResponse.routes[0].geometry.coordinates[i] + "]" + "<br>";
    }
    document.getElementById("coordsonlyID").innerHTML = x;*/



    //Convert the jsonResponse from a Json into a formatted string ready to be sent to a server
    //Returning the entire GeoJson
    delete jsonResponse.waypoints;
    delete jsonResponse.code;
    delete jsonResponse.uuid;
    console.log(Object.getOwnPropertyNames(req));
    // expected output: Array ["a", "b", "c"]
    //var textedJson = JSON.stringify(jsonResponse, undefined, 2);
    //document.getElementById("completegeojson").innerHTML = textedJson;


    //Add The Route To The Map
    addRoute(coords);
  };


  req.send();
}

// adds the route as a layer on the map
function addRoute (coords) {
  // check if the route is already loaded
  if (map.getSource('route')) {
    map.removeLayer('route')
    map.removeSource('route')
  } else{
    map.addLayer({
      "id": "route",
      "type": "line",
      "source": {
        "type": "geojson",
        "data": {
          "type": "Feature",
          "properties": {},
          "geometry": coords
        }
      },
      "layout": {
        "line-join": "round",
        "line-cap": "round"
      },
      "paint": {
        "line-color": "#FFC300", //"#2c9952" Green, //3b9ddd //#FFC300 Yellow
        "line-width": 4,
        "line-opacity": 0.8
      }
    }),

    //Add directional arrows to route
    map.addLayer({
      id: 'routearrows',
      type: 'symbol',
      source: 'route',
      layout: {
        'symbol-placement': 'line',
        'text-field': '▶',
        'text-size': {
          base: 2,
          stops: [[12, 24], [22, 60]]
        },
        'symbol-spacing': {
          base: 1,
          stops: [[12, 30], [22, 160]]
        },
        'text-keep-upright': false
      },
      paint: {
        'text-color': '#FFC300',  //Yellow
        'text-halo-color': 'hsl(55, 11%, 96%)',
        'text-halo-width': 3
      }
    });
  };

var TNRRoute = {
    "id": "TNR Route",
        "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "properties": {},
                    "geometry": coords
                }
            ]
        };
    //Convert the jsonResponse from a Json into a formatted string ready to be sent to a server
    //Returning the entire GeoJson

    var output = JSON.stringify(TNRRoute, undefined, 2);
    document.getElementById("completegeojson").innerHTML = "<b>Geojson Output:</b> <br>" + output;
}




// remove the layer if it exists
function removeRoute () {
  if (map.getSource('route')) {
    map.removeLayer('route');
    map.removeLayer('routearrows');
    map.removeSource('route');
    instructions.innerHTML = '';
    //I think I can delete this since I added the above line recently document.getElementById('calculated-line').innerHTML = '';
  } else  {
        return;
  }
}



//---------------------------------------------------------------------------------------
// --------------------------- Step 5: Add Custom Controls -----------------------------
//---------------------------------------------------------------------------------------


    /* No longer need regular driving directions
    //Adds driving directions to top-left corner
    map.addControl(new MapboxDirections({
        accessToken: 'pk.eyJ1IjoiZHlsYW5jIiwiYSI6Im53UGgtaVEifQ.RJiPqXwEtCLTLl-Vmd1GWQ' 
    }), 'top-right');
    */

    // Adds Mapbox Search Box
    map.addControl(new MapboxGeocoder({
        accessToken: 'pk.eyJ1IjoiZHlsYW5jIiwiYSI6Im53UGgtaVEifQ.RJiPqXwEtCLTLl-Vmd1GWQ' 
    }));

    // Add User-Geolocate to the map
    map.addControl(new mapboxgl.GeolocateControl({
        positionOptions: {
        enableHighAccuracy: true
        },
        trackUserLocation: true
        }));

    // Add zoom and rotation controls to the map
    map.addControl(new mapboxgl.NavigationControl());

    // Add the draw tool to the map
    map.addControl(draw);

    // Shrinks Attribution to a small hover icon for displays 640px or less
    map.addControl(new mapboxgl.AttributionControl({
            compact: true,   
        }));


// The 'building' layer in the mapbox-streets vector source contains building-height
// data from OpenStreetMap.
map.on('load', function() {
// Insert the layer beneath any symbol layer.
var layers = map.getStyle().layers;
 
var labelLayerId;
for (var i = 0; i < layers.length; i++) {
if (layers[i].type === 'symbol' && layers[i].layout['text-field']) {
labelLayerId = layers[i].id;
break;
}
}
 
map.addLayer({
'id': '3d-buildings',
'source': 'composite',
'source-layer': 'building',
'filter': ['==', 'extrude', 'true'],
'type': 'fill-extrusion',
'minzoom': 15,
'paint': {
'fill-extrusion-color': '#aaa',
 
// use an 'interpolate' expression to add a smooth transition effect to the
// buildings as the user zooms in
'fill-extrusion-height': [
"interpolate", ["linear"], ["zoom"],
15, 0,
15.05, ["get", "height"]
],
'fill-extrusion-base': [
"interpolate", ["linear"], ["zoom"],
15, 0,
15.05, ["get", "min_height"]
],
'fill-extrusion-opacity': .6
}
}, labelLayerId);
});

</script>


</body>
</html> 